<UserControl x:Class="GUI.Views.CameraView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Unloaded="UserControl_Unloaded">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>  <!-- Camera Feed -->
            <ColumnDefinition Width="1*"/>  <!-- Controls -->
        </Grid.ColumnDefinitions>
        
        <!-- ===== LEFT COLUMN: Camera Feed ===== -->
        <GroupBox Grid.Column="0" Header="Camera Control" Margin="0,0,10,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Camera Status Bar -->
                <Border Grid.Row="0" Background="LightGray" Padding="10" Margin="0,0,0,5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="📹" FontSize="16" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding CameraStatus}" FontWeight="Bold"/>
                            <TextBlock Text=" | " Margin="5,0"/>
                            <TextBlock Text="{Binding Resolution}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <!-- Recording Indicator -->
                            <Ellipse Width="10" Height="10" Fill="Red" Margin="0,0,5,0">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>
                            <TextBlock Text="{Binding RecordingTime}" Foreground="Red" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Camera Display -->
                <Border Grid.Row="1" Background="Black" BorderBrush="Gray" BorderThickness="2" Margin="5">
                    <Grid>
                        <Image Name="CameraFeed" Source="{Binding CameraSource}"
                               Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        
                        <!-- No Camera Placeholder -->
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding CameraSource}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            <TextBlock Text="📷" FontSize="64" Foreground="Gray" 
                                      HorizontalAlignment="Center" Margin="0,0,0,15"/>
                            <TextBlock Text="No Camera Connected" 
                                      HorizontalAlignment="Center" 
                                      Foreground="Gray" FontSize="16"/>
                            <TextBlock Text="Connect a camera to start" 
                                      HorizontalAlignment="Center" 
                                      Foreground="Gray" FontSize="12" Margin="0,5,0,0"/>
                        </StackPanel>
                        
                        <!-- Overlay Controls -->
                        <Canvas Name="OverlayCanvas">
                            <!-- Focus Rectangle -->
                            <Rectangle Name="FocusRect" 
                                     Width="100" Height="100"
                                     Stroke="Yellow" StrokeThickness="2"
                                     Fill="Transparent"
                                     Canvas.Left="250" Canvas.Top="150"
                                     Visibility="{Binding ShowFocusRect, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        </Canvas>
                        
                        <!-- Corner Info -->
                        <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" 
                                   Background="#AA000000" Margin="10">
                            <Border Padding="8">
                                <StackPanel>
                                    <TextBlock Text="{Binding ZoomLevel, StringFormat='🔍 Zoom: {0}%'}" Foreground="White" FontSize="10"/>
                                    <TextBlock Text="{Binding ExposureValue, StringFormat='⚡ Exposure: {0}'}" Foreground="White" FontSize="10"/>
                                    <TextBlock Text="{Binding FocusMode, StringFormat='🎯 Focus: {0}'}" Foreground="White" FontSize="10"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Quick Controls Bar -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="5">
                    <Button Content="📷 Capture" Margin="0,0,5,0" Padding="10,5"
                            Command="{Binding CaptureCommand}"
                            IsEnabled="{Binding IsCameraConnected}"/>
                    
                    <Button Content="🎥 Record" Margin="0,0,5,0" Padding="10,5"
                            Command="{Binding RecordCommand}"
                            IsEnabled="{Binding IsCameraConnected}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                        <Setter Property="Content" Value="⏹️ Stop"/>
                                        <Setter Property="Background" Value="Red"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    
                    <Button Content="🎯 Focus" Margin="0,0,5,0" Padding="10,5"
                            Command="{Binding AutoFocusCommand}"
                            IsEnabled="{Binding IsCameraConnected}"/>
                    
                    <Button Content="💾 Save" Padding="10,5"
                            Command="{Binding SaveCommand}"
                            IsEnabled="{Binding HasCapturedImage}"/>
                </StackPanel>
            </Grid>
        </GroupBox>
        
        <!-- ===== RIGHT COLUMN: Camera Controls ===== -->
        <Grid Grid.Column="1" Margin="10,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Device Selection -->
            <GroupBox Grid.Row="0" Header="Camera Device" Margin="0,0,0,10">
                <StackPanel Margin="10">
                    <ComboBox ItemsSource="{Binding AvailableCameras}"
                              SelectedItem="{Binding SelectedCamera}"
                              DisplayMemberPath="Name"
                              Margin="0,0,0,10"/>
                    
                    <StackPanel Orientation="Horizontal">
                        <Button Content="🔄 Refresh" Margin="0,0,5,0" Padding="8,4"
                                Command="{Binding RefreshCamerasCommand}"/>
                        <Button Content="🔗 Connect" Padding="8,4"
                                Command="{Binding ConnectCameraCommand}"
                                IsEnabled="{Binding CanConnect}"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
            
            <!-- Camera Settings -->
            <GroupBox Grid.Row="1" Header="Camera Settings" Margin="0,0,0,10">
                <StackPanel Margin="10">
                    <!-- Resolution -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Resolution" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ComboBox ItemsSource="{Binding AvailableResolutions}"
                                  SelectedItem="{Binding SelectedResolution}"/>
                    </StackPanel>
                    
                    <!-- Frame Rate -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Frame Rate" FontWeight="Bold" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal">
                            <Slider Width="100" Minimum="1" Maximum="60" 
                                    Value="{Binding FrameRate}" TickFrequency="10"/>
                            <TextBlock Text="{Binding FrameRate}" Width="30" 
                                      VerticalAlignment="Center" Margin="10,0,0,0"/>
                            <TextBlock Text="FPS" VerticalAlignment="Center" Margin="5,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Exposure -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Exposure" FontWeight="Bold" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal">
                            <Slider Width="100" Minimum="-5" Maximum="5" 
                                    Value="{Binding ExposureValue}" TickFrequency="1"/>
                            <TextBlock Text="{Binding ExposureValue, StringFormat=F1}" Width="30" 
                                      VerticalAlignment="Center" Margin="10,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Zoom -->
                    <StackPanel>
                        <TextBlock Text="Zoom" FontWeight="Bold" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal">
                            <Slider Width="100" Minimum="100" Maximum="800" 
                                    Value="{Binding ZoomLevel}" TickFrequency="100"/>
                            <TextBlock Text="{Binding ZoomLevel}" Width="30" 
                                      VerticalAlignment="Center" Margin="10,0,0,0"/>
                            <TextBlock Text="%" VerticalAlignment="Center" Margin="0,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
            
            <!-- Capture Settings -->
            <GroupBox Grid.Row="2" Header="Capture Settings" Margin="0,0,0,10">
                <StackPanel Margin="10">
                    <CheckBox Content="Auto-save captures" Margin="0,5"/>
                    <CheckBox Content="Show timestamp" Margin="0,5"/>
                    <CheckBox Content="Apply filters" Margin="0,5"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                        <TextBlock Text="Format:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <ComboBox Width="80">
                            <ComboBoxItem Content="JPG" IsSelected="True"/>
                            <ComboBoxItem Content="PNG"/>
                            <ComboBoxItem Content="BMP"/>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
            
            <!-- Camera Stats -->
            <GroupBox Grid.Row="3" Header="Statistics" VerticalAlignment="Bottom">
                <StackPanel Margin="10">
                    <TextBlock Text="📊 Camera Stats" FontWeight="Bold" Margin="0,0,0,10"/>
                    <StackPanel Orientation="Horizontal" Margin="0,2">
                        <TextBlock Text="Captured:" Width="70"/>
                        <TextBlock Text="{Binding CaptureCount}" FontWeight="Bold"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,2">
                        <TextBlock Text="Recorded:" Width="70"/>
                        <TextBlock Text="{Binding RecordingCount}" FontWeight="Bold"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,2">
                        <TextBlock Text="Uptime:" Width="70"/>
                        <TextBlock Text="{Binding CameraUptime}" FontWeight="Bold"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
        </Grid>
    </Grid>
</UserControl>